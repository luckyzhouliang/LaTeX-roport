\chapter{基于hp自适应伪谱法的再入轨迹设计与分析}

飞船再入环境严苛，整个再入段受热流、过载、动压等约束的影响。应急条件下，飞船为到达目标着陆场，再入轨迹存在
不同的轨迹形式。本章研究飞船再入机动可达域的快速确定问题，利用伪谱方法完成不同再入轨迹形式下的可达域确定。
通过容许不同的轨迹形式，扩展再入点的范围，为应急返回提供更大的窗口。

\section{再入返回轨迹设计问题建模}
\subsection{再入动力学方程}
在探月飞船再入返回轨迹设计问题中，采用三自由度运动模型，采用“瞬时平衡假设”，认为返回器始终以配平攻角飞行，且侧滑角为零。
考虑地球自转，圆球假设下，忽略地球扁率和侧滑角等的影响，在半速度系下建立运动方程，以时间为自变量的飞船无动力再入动力学方程满足
\begin{equation}
	\left\{
	\begin{aligned}
		\frac{\dif r}{\dif t}=       & v \sin \theta                                                           \\
		\frac{\dif \lambda}{\dif t}= & \frac{v \cos \theta \sin \psi}
		{r \cos \phi}                                                                                          \\
		\frac{\dif \phi}{\dif t}=    & \frac{v \cos \theta \cos \psi}{r}                                       \\
		\frac{\dif v}{\dif t}=       & -D-g \sin \theta +\omega_e^2r\cos\phi \sin\theta \cos\phi-
		\omega_e^2r\cos\phi\cos\theta\sin\phi\cos\sigma                                                        \\
		\frac{\dif\theta}{\dif t} =  & \frac{L\cos\sigma}{v}+(\frac{v}{r}-
		\frac{g}{v})\cos\theta+2\omega_e\cos\phi\sin\sigma                                                     \\
		                             & {}+\frac{\omega_e^2r\cos\phi\cos\theta\cos\phi}{v}                      \\
		\frac{\dif\psi}{\dif t} =    & \frac{L\sin\sigma}{v\cos\theta}+\frac{v\sin \psi\cos \theta\tan\phi}{r}
		-2\omega_e(\cos\phi\tan\theta\cos\sigma-\sin\phi)                                                      \\
		                             & {}+\frac{\omega_e^2r}{\cos\theta}sin\phi\cos\phi\sin\sigma
	\end{aligned}
	\right.
\end{equation}
其中，$r$为地心距，$\lambda$和$\phi$为经纬度，$v$为相对地球速度，$\theta$为当地速度倾角，表征速度与当地水平的夹角，
以及$\psi$为速度方位角，表征速度在当地水平面内的投影与当地正北方向的夹角，顺时针为正；% 表述可能错误
$\sigma$为控制量倾侧角，反映了升力对铅锤面的倾斜；$ \omega_e $为地球自转角速度，$L$，$D$为再入过程中的升力阻力加速度，满足
\begin{align}
	L & =\frac{C_L\rho v^2S}{2m} \\
	D & =\frac{C_D\rho v^2S}{2m}
\end{align}
其中:$ C_L $和$ C_D $为气动升力系数和气动阻力系数，$ \rho $为大气密度，$ m $为飞行器质量，$ S $为飞船的参考面积。

大气密度$ \rho $可采用指数模型、多阶段拟合公式和美国US1976标准大气模型等，考虑到精度和计算速度的要求，最终
采用多阶段的拟合公式，更多可参考\upcite{贾沛然-1993-远程火箭弹道学}。
\begin{equation}
	\rho=\rho_0 e^{-\beta h}
\end{equation}

\subsection{约束分析}
因探月返回器高速再入的特点，过载和热流等约束十分苛刻。为了保证再入过程的安全，根据约束的性质划分为两类:过程约束和终端约束。
\subsubsection{过程约束}
\begin{enumerate}
	\item 热流约束\par
	      高超声速气动加热对热防护系统（TPS）的影响,为避免飞行器被烧毁，因此需对飞行器再入过程中的热流密度进行限制。
	      通常采用驻点热流密度作为约束指标，计算公式如下：
	      \begin{equation}
		      \dot{Q} = k_s\left(\frac{\rho}{\rho_{0}}\right)^{0.5}\left(\frac{v}{V_{c}}\right)^{m}
	      \end{equation}
	      其中，$ k_s $为热流相关常数，$ V_c=7.9\mathrm{km/s} $为参考的第一宇宙速度，$ m $可取3或3.15，本文中取3.15
	\item 过载约束\par
	      考虑到内部结构、材料的限制，需要对过载进行限制，要求瞬时过载小于最大允许过载，即
	      \begin{equation}
		      n=\sqrt{{{L}^{2}}+{{D}^{2}}}\le {{n}_{\max }}
	      \end{equation}
	      其中，$ n_{\max} $为最大允许过载值。
	\item 动压约束\par
	      动压对控制系统的影响和侧向稳定性的要求，
	      \begin{equation}
		      q=\frac{1}{2} \rho V^{2} \leq q_{\max }
	      \end{equation}
	\item 跃起高度约束\par
	      此外，为防止跳出高度过高导致任务失败，路径约束还应包括一个高度约束。这里设定最大高度不超过300km，
	      \begin{equation}
		      h<h_{\max}
	      \end{equation}
	\item 控制量约束\par
	      控制量倾侧角受限于执行机构，飞船的控制能力有限，实际倾侧角机动不可能瞬时完成，需要对倾侧角和倾侧角变化
	      速率进行限幅，即
	      \begin{equation}
		      \left\{
		      \begin{aligned}
			      \abs{\sigma}       & \leq \sigma_{\max}       \\
			      \abs{\dot{\sigma}} & \leq \dot{\sigma}_{\max} \\
		      \end{aligned} \right.
	      \end{equation}
\end{enumerate}

\subsubsection{终端约束}
对于再入问题中的终端约束，包含起始点和终点的状态约束。起始点处的状态在分析中通常为给定值，在初始时刻$ t_0 $状态满足
\begin{equation}
	\left\{ \begin{aligned}
		h(t_0)=h_0,\lambda(t_0)=\lambda_0,\phi(t_0)=\phi_0 \\
		v(t_0)=v_0,\theta(t_0)=\theta_0,\psi(t_0)=\psi_0
	\end{aligned} \right.
\end{equation}

终点处根据研究问题可分为固定终点和自由终点两种情况，数学上表达为：
\begin{enumerate}
	\item 固定终点的约束条件\par
	      终点处位置固定，但速度和速度倾角存在范围约束，即：
	      \begin{equation}
		      \left\{ \begin{aligned}
				  h(t_f)&=h_{f}, \lambda(t_f)=\lambda_{f}, \phi(t_f)=\phi_{f} \\
				  v &\geq v_{f}, \theta_{\min } \leq \theta \leq \theta_{\max }
		      \end{aligned}\right.
	      \end{equation}
	\item 自由终点的约束条件\par
	对于求解可达域等问题时，终点不固定，通常约束设置为：
	\begin{equation}
		h(t_f)=h_{f}, v \geq v_{f}, \theta_{\min } \leq \theta \leq \theta_{\max }
	\end{equation}
\end{enumerate}

\section{hp自适应伪谱法的求解策略}
hp自适应伪谱法是伪谱方法的一种，求解再入问题在计算速度有较大优势。hp自适应伪谱法主要包含两部分内容：
伪谱化离散和hp自适应网格细化。
\subsection{LGR离散化方法}
%在绪论中介绍轨迹优化问题描述
首先将在连续时间$ [t_0,t_f] $上的问题划分为$ K $个子区间，记第$ k $个子区间为$ [t_{k-1},t_k] $，有$ t_0<t_1<t_2<\ldots<t_k $。对于
第k个子区间，首先需要将时域$ t\in[t_{k-1},t_k] $，转换到$ \tau \in [-1,1] $，即：
\begin{equation}
	\tau = \frac{2 t-\left(t_{k-1}+t_{k}\right)}{t_{k}-t_{k-1}}
\end{equation}

经过区间划分后，$ [t_0,t_f] $时间内的连续优化问题可以表述为:
\begin{enumerate}
	\item 动力学方程
	\begin{equation}
		\frac{\dif \boldsymbol{x}^{(k)}(\tau)}{\dif \tau}=\frac{t_{k}-t_{k-1}}{2} f\left(\boldsymbol{x}^{(k)}(\tau), \boldsymbol{u}^{(k)}(\tau)\right), \quad(k=1, \cdots, K)
	\end{equation}
	\item 目标函数
	\begin{equation}
		J=\Phi\left(\boldsymbol{x}^{(1)}(-1), t_{0}, \boldsymbol{x}^{(K)}(+1), t_{K}\right)+\sum_{k=1}^{K} \frac{t_{k}-t_{k-1}}{2} \int_{t_{0}}^{t_{f}} g\left(\boldsymbol{x}^{(k)}(\tau), \boldsymbol{u}^{(k)}(\tau)\right) d \tau
	\end{equation}
	\item 路径约束
	\begin{equation}
		\frac{t_{k}-t_{k-1}}{2} \boldsymbol{C}\left(\boldsymbol{x}^{(k)}(\tau), \boldsymbol{u}^{(k)}(\tau)\right) \leq 0 \quad(k=1, \cdots, K)
	\end{equation}
	\item 边界条件
	\begin{equation}
		\phi\left(\boldsymbol{x}^{(1)}(-1), t_{0}, \boldsymbol{x}^{(K)}(+1), t_{K}\right)=0
	\end{equation}
\end{enumerate}

引入区间划分后，附加产生额外的内点约束：
\begin{equation}
	\phi\left(\boldsymbol{x}^{(1)}(-1), t_{0}, \boldsymbol{x}^{(K)}(+1), t_{K}\right)=0
\end{equation}

进一步，需要对问题进行离散化求解。Radau伪谱法的配点为Legendre-Gauss-Radau（LGR）点，LGR点相对于原点是不对称的，并且不是唯一的，
可以使用初始点或终点来定义它们。一般的LGR点配置在 $ [t_{k-1},t_k) $上（包含起点），将其归一化后，即端点$ \tau_{N_k+1}^{(k)}=+1 $为非配点。区间内的离散点为$ -1=\tau_1<\tau_2<\cdots<\tau_{N_k}<\tau_{N_k+1} $，此处省略上标$ k $。
对于任意一个子区间$  [t_{k-1},t_k] $，取$ N_k $个LGR点，取插值点为$ N_k $个LGR点与终端点$ \tau_{N_k+1}^{(k)}=+1 $，状态量的近似可以表示为：
\begin{equation}
	\boldsymbol{x}^{(k)}(\tau) \approx \boldsymbol{X}^{(k)}(\tau)=\sum_{j=1}^{N_{k}+1} \boldsymbol{X}_{j}^{(k)} L_{j}^{(k)}(\tau)
	\label{eq:state}
\end{equation}
其中，简记$ \boldsymbol{X}_{j}^{(k)}=\boldsymbol{X}^{(k)}\left(\tau_{j}^{(k)}\right)$，$ \quad L_{j}^{(k)}(\tau) $为Lagrange插值
基函数：
\begin{equation}
	L_{j}^{(k)}(\tau)=\prod_{i=1, i \neq j}^{N_{k}+1} \frac{\tau-\tau_{i}^{(k)}}{\tau_{j}^{(k)}-\tau_{i}^{(k)}}
\end{equation}

获得状态量的近似后，进一步对于动力学方程的状态导数可以近似为：
\begin{equation}
	\frac{\dif \boldsymbol{x}^{(k)}(\tau)}{\dif \tau} \approx \frac{\dif \boldsymbol{X}^{(k)}(\tau)}{\dif \tau}=\sum_{j=1}^{N_{k}+1} \boldsymbol{X}_{j}^{(k)} \dot{L}_{j}^{(k)}(\tau)
\end{equation}

状态量的近似通过在$ N_k+1 $个插值点处的Lagrange插值多项式近似，对于控制量通过在$ N_k $个配点处插值获得，有：
\begin{equation}
	\boldsymbol{u}^{(k)}(\tau) \approx \boldsymbol{U}^{(k)}(\tau)=\sum_{i=1}^{N_{k}} \boldsymbol{U}_{i}^{(k)}\widetilde{L}_{i}^{(k)}(\tau)
	\label{eq:control}
\end{equation}
其中$ \widetilde{L}_{i}^{(k)}(\tau) $与$ L_{j}^{(k)}(\tau) $具有类似的形式，此处不再列出。

经过\eqref{eq:state}-\eqref{eq:control}的处理，连续时间上的原最优控制问题可转化为其离散形式：
\begin{enumerate}
	\item 动力学方程\par
	在配点处，原动力学微分方程约束转换为代数约束形式，表达为：
	\begin{equation}
		\sum_{j=1}^{N_{k}+1} \boldsymbol{X}_{j}^{(k)} D_{i j}^{(k)}-\frac{t_{k}-t_{k-1}}{2} \boldsymbol{f}_{i}^{(k)}=0, \quad\left(i=1, \cdots, N_{k}, k=1, \cdots, K\right)
	\end{equation}
	其中，$\boldsymbol{f}_{i}^{(k)}=\boldsymbol{f}\left(\boldsymbol{X}_{i}^{(k)}, \boldsymbol{U}_{i}^{(k)}\right)$，简记$ \boldsymbol{U}_{i}^{(k)}=\boldsymbol{U}^{(k)}\left(\tau_{i}^{(k)}\right)$，式中：
	\begin{equation}
		D_{i j}^{(k)}=\dot{L}_{j}^{(k)}\left(\tau_{i}^{(k)}\right) \quad\left(i=1, \cdots, N_{k}, j=1, \cdots, N_{k}+1\right)
	\end{equation}
	$ \left\{D_{i j}^{(k)}\right\} $为区间$ k $内大小$ N_k\times (N_k+1) $的微分矩阵，通常可以利用差分近似。
	\item 目标函数\par
	目标函数转化为
	\begin{equation}
		J=\Phi\left(\boldsymbol{X}^{(1)}(-1), t_{0}, \boldsymbol{X}_{N_{K}+1}^{(K)}, t_{K}\right)+\sum_{k=1}^{K} \sum_{j=1}^{N_{K}} \frac{t_{k}-t_{k-1}}{2} w_{j}^{(k)} g_{j}^{(k)}
	\end{equation}
	其中，$w_{j}^{(k)}=\int_{-1}^{1} L_{j}^{(k)}(\tau) d \tau$为第k个子区间上的Legendre-Gauss权重，$g_{j}^{(k)}=g\left(\boldsymbol{X}_{j}^{(k)}, \boldsymbol{U}_{j}^{(k)}\right)$。
	\item 路径约束\par
	\begin{equation}
		\frac{t_{k}-t_{k-1}}{2} \boldsymbol{C}^{(k)}\left(\boldsymbol{X}_{i}^{(k)}, \boldsymbol{U}_{i}^{(k)}\right) \leq 0 \quad\left(i=1, \cdots, N_{k}, k=1, \cdots, K\right)
	\end{equation}
	\item 边界条件\par
	\begin{equation}\phi\left(\boldsymbol{X}^{(1)}(-1), t_{0}, \boldsymbol{X}_{N_{K}+1}^{(K)}, t_{K}\right)=0\end{equation}
	同时离散化引入的附加内点约束变为：
	\begin{equation}
		\boldsymbol{X}_{N_{k}+1}^{(k)}=\boldsymbol{X}_{1}^{(k+1)}, \quad(k=1, \ldots, K-1)
	\end{equation}
\end{enumerate}

文献【19】从近似精度和计算效率等方面对上述三种伪谱法进行了比较。 Radau伪谱法和Gauss伪谱法在状态变量、控制变量
和共轭变量的近似精度上均优于 Legendre伪谱法，同时， Gauss伪谱法对共轭变量边界值的估计精度高于Radau伪谱法，
且在处理含初始和终端约束的问题上具有优势。在计算效率方面，求解相同规模问题时三种方法耗时差别不大。
\subsection{hp自适应网格细化方法}


\section{伪谱法快速可达域计算与分析}
\section{短航程再入轨迹设计结果对比}

\subsection{}